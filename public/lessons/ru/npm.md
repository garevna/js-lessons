# ![ico-50 npm] npm

Менеджер пакетов **npm** - это крупнейший в мире реестр программного обеспечения
( около 3 миллиардов загрузок в неделю )

В реестре содержится более 600 000 пакетов

Open-source разработчики всего мира используют **npm**
для совместного использования и заимствования пакетов

_______________________________________________________________________________________________

## ![ico-25 icon] Installation

Поскольку **npm** идет в составе **Node.js**, необходимо установить [![ico-70 node]](https://nodejs.org)

Далее заходим в ![ico-25 bash]

___________________________________________________________________________________________________

## ![ico-40 npm] Commands

![ico-20 bash] which npm

![](https://lh6.googleusercontent.com/w65C2Uqbs47V9db_Yn_oR4ui2MUFvFWnl6Yb4riD4zImCTTPUWSLDNXiUD7VuJdl0eQgsK_iLfvTb2kBwLuq64VhDpXYUiTQctg2zbP3Vt-w34LtxtVjY7jHfX4wvY-prbVrtwZBh1UEf5M)

![ico-20 bash] npm --version

![](https://lh6.googleusercontent.com/cP5U5nwO7rgudZfLJCkqvRU9Am4wI7jzAJzz3G0iBG-Rt9pnrV9xpIFqTvcjJk-YgZSYhpe1qOwyqe6YxMdZbKI7HqnczyStJEO2F7Yve01Fcgs2_vio4ExYpaQmGV0TepBGbcvQYIdJ_oM)


![ico-20 bash] npm root

Папка для глобальной установки пакетов

![](createPath("illustrations","npm-root.png"))

_____________________________________________________________________________________________

### ![ico-40 npm] npm init

Эта команда создаст файл [**~package.json~**](https://docs.npmjs.com/files/package.json) в текущей папке
^^Предварительно нужно создать новую папку для проекта и перейти в нее^^

![ico-20 warn] **~package.json~** хранит зависимости проекта, т.е. список пакетов, необходимых для проекта
^^( для каждого пакета указана нужная версия )^^

^^При создании файла **~package.json~** **npm** задаст ряд вопросов о проекте,^^
^^который будет расположен в текущей папке^^

^^Ваши ответы будут использованы для установки значений полей:^^

|•| **~name~**        | ^^название проекта^^ |
|•| **~version~**     | ^^версия^^ |
|•| **~description~** | ^^краткое описание^^ |
|•| **~author~**      | ^^автор ( вы )^^ |
|•| **~repository~**  | ^^ссылка на репозиторий проекта^^ |
|•| **~keywords~**    | ^^ключевые слова^^ |
|•| **~scripts~**     | ^^объект, описывающий команды запуска скриптов с помощью **~npm run~**^^ |

^^^[npm init]

![](https://lh4.googleusercontent.com/ZfltZTmbCAsgDdV4IMmNt92vXLdwU5pLyl446vLzdZ5bfuOVx_GIGW-WP2TtxVLriNWUrhkAn2JnNdmYEUszIiQKNkIsGKiuJEfW4t9c3L2-HnhTYjmTaQwW6vmDb1snqoyQ6w0IcjsvR9E)

^^^

^^Поскольку в дальнейшем вы сможете редактировать файл **~package.json~**,^^
^^можно особо не заморачиваться первоначальными установками^^ ![ico-20 wink]

_________________________________________________________________________________________________

### ![ico-40 npm] package.json

Теперь при установке любого пакета запись об этом пакете будет автоматически добавляться в  раздел **_~dependencies~_** 
файла **~package.json~**

Все пакеты, которые необходимы для проекта, будут описаны в разделах 

| ![ico-20 folder] | **~dependencies~**    | ^^**зависимости пакета**<br>эти пакеты будут непосредственно включены в сборку приложения^^ |
| ![ico-20 folder] | **~devDependencies~** | ^^**пакеты, необходимые на этапе сборки**<br>в само приложение не встраиваются^^ |

____________________________________________________________________________________________

### ![ico-40 npm] .npmrc

Файл конфигурации, откуда ( наряду с ~package.json~ ) npm  будет считывать установки

^^Файл  .npmrc  может существовать для каждого проекта,^^
^^для каждого пользователя,^^
^^и глобально^^

Посмотреть настройки конфигурации по умолчанию можно с помощью команды

••![ico-20 bash] npm config ls -l••

Изменить настройки можно с помощью команды

••![ico-20 bash] npm config••

Например, для автоматического сохранения зависимостей:

••![ico-20 bash] npm config set save=true••

а для сохранения зависимостей с указанием точной версии пакета:

••![ico-20 bash] npm config set save-exact=true••

___________________________________________________________________________________

### ![ico-40 npm] npm install

В своих проектах вы будете использовать различные пакеты, облегчающие жизнь ![ico-20 wink]

^^Часть этих пакетов нужна будет для сборки вашего приложения,^^
^^его тестирования, отладки, транспилляции и т.д.^^
^^Эти пакеты не будут включаться в тело приложения^^
^^Они помогут это тело постоить^^

^^Однако в самом приложении вы будете использовать сторонние библиотеки, фреймворки и т.д.^^
^^Эти пакеты будут включены в сборку вашего приложения^^

^^Короче, все эти пакеты нужно установить^^

^^Для этого вам понадобится команда **~npm install~**^^

___________________________________________________________________________

![ico-20 npm] Опция  **~-g~**  позволяет установить пакет **глобально**, чтобы он был доступен всем вашим приложениям

^^![ico-20 pin] **Глобальная установка пакета** с именем &lt;имя пакета>:^^

••![ico-20 bash] npm install -g &lt;имя пакета>••

^^![ico-20 pin] **Локальная установка пакета** с именем &lt;имя пакета>:^^

••![ico-20 bash] npm install &lt;имя пакета>••

![ico-20 speach] ^^_Локальная_ - значит, пакет будет установлен в той директории ( папке пректа ), в которой вы находитесь в момент вызова  **~npm~**^^

_____________________________________________________________________________________

![ico-20 npm] При установке пакетов с опцией _~--save~_   или _~--save-dev~_ 

**~npm~**   будет добавлять соответствующие записи в раздел ![ico-20 dir] **~dependencies~**  или  ![ico-20 dir] **~devDependencies~**

![ico-20 cap] Например, команда

••![ico-20 bash] npm install  -g  css-loader  --save-dev••

^^установит загрузчик  **~css-loader~**   глобально^^
^^и внесет соответствующую запись в **_~devDependencies~_**^^

_____________________________________________________________________

### ![ico-30 folder] node_modules

Все установленные локально пакеты будут находиться в папке ![ico-20 dir] **~node_modules~**  текущего проекта

![ico-20 warn] Папку **~node_modules~** необходимо всегда добавлять в **~gitignore~**

![ico-30 git] gitignore

![](https://lh6.googleusercontent.com/SLXHR8Om5imjD3M9PUDQeB8WmOoBDYBYZYGxJC1IhdUji_AxJca4r_c9sxL1nK7Ly-naC8DX9vKDaf03a3w2E3zYUxnXeatwEfu8oe0jlGOlfqkO0Fftlrb8JJFoA-odZqTAzbuur3SD_ZQ)

^^В git-репозитории никто никогда не хранит папку ![ico-20 dir] **~node_modules~**,^^
^^однако если клонировать репо,^^
^^то установить все необходимые пакеты при наличии файла **~package.json~**  очень легко^^

^^достаточно выполнить консольную команду ![ico-20 bash] ~npm install~,^^
^^и все пакеты, перечисленные в package.json, будут установлены^^
^^в соответствии с указанными версиями^^

_______________________________________________________________________________________________________

### ![ico-40 npm] npm run

Прежде, чем использовать эту команду, нужно внести определенные изменения в файл **~package.json~**

Конкретнее - в раздел **_~scripts~_**:

~~~js
"scripts": {
    "алиас" : "путь_к_файлу_скрипта"
    ...
}
~~~

В этом разделе мы описываем скрипты или пакеты, которые будем запускать с помощью команды  ~npm run~

Эта команда запускает указанный скрипт

~~~js
"scripts": {
    "start" : "node index.js",
    "build" : "webpack"
}
~~~

_______________________________________________________________________________________

### ![ico-40 npm] npm list

**Вывод списка установленных пакетов**

Для вывода списка пакетов, установленных глобально, используйте опцию **~-g~**

••![ico-20 bash] npm list -g••

![](https://lh6.googleusercontent.com/MCZpi5JBh9OCJmvpvl139V_WNTvFRlhf_qoDsLRh4eETCYDngtEeiuLxiipbaiqfs-zizH5SVgUbKgOpvXMNkoA-88_9TdjKSbp7qBIAb5Px51_x_Z89MpuhJU0UcSvt-Vg-04nHlz2c6s8)

••![ico-20 bash] npm list --depth=0••

Для вывода краткого списка ( без подробностей о каждом пакете ) используется опция **~--depth=0~**

![](http://icecream.me/uploads/ca3c97a33ec377e15452bfcc82615ab9.png)

__________________________________________________________________________________________________

### ![ico-40 npm] npm search

**поиск пакетов**

••![ico-20 bash] npm search babel••

![](https://lh4.googleusercontent.com/oo2pdarDWkeQdqJVNbF8-LI4Z0Ki6DpzQsNyaRdY7zsjKByhVHDNw2t9v2RoUNw1HAUhj6YhlUAX3kYfemfira5X2Zgmp2MYIX0SJXAI0Iviv4LJRUl3DLCoJFirCr9lh3TcnQBEs1sQkRU)

____________________________________________________________________________

### ![ico-40 npm] npm link

**Создание символических ссылок**

Когда вы запускаете ~npm link~ в корневой папке проекта, **~npm~** создает символическую ссылку из вашего каталога **_~global node_modules~_** в папку проекта

**~global node_modules~** представляет собой специальную папку, в которой хранятся все глобально установленные модули

••![ico-20 bash] npm install -g••

Вы можете найти путь к вашему глобальному каталогу ~node_modules~, запустив 

••![ico-20 bash] npm root -g••

^^^[Пример 1]

создание символической ссылки в глобальной папке ( ** ~** ) на пакет в локальной папке

Перейдем в папку ~z/home/test/node_modules~ и создадим символическую ссылку на пакет **~express~** в текущей папке

![](http://icecream.me/uploads/c822230d4ea7d8c23989faa08b7e0533.png)

^^^

^^^[Пример 2]

Теперь перейдем в папку другого проекта ( _~/z/home/js-samples~_ )
и создадим там символическую ссылку на пакет **_express_**,
установленный в папке ( _~/z/home/test/node_modules~_ ),
на который есть символическая ссылка из глобальной папки ( ** ~** )

![](http://icecream.me/uploads/68f176dd4c7535aeb9d3e1fbedfd9830.png)

^^^

![ico-20 warn] Команда **~link~** предназначена для создания символических ссылок только на пакеты

Для отмены установленной связи используем команду:

••![ico-20 bash] npm unlink images••
••![ico-20 bash] ls -al $(npm root -g)••

____________________________________________________________________________________

## ![ico-40 npm] package-lock.json

Каждый раз при установке новой зависимости npm автоматически обновляет lock-файл с именем **_~package-lock.json~_**

**_~package-lock.json~_** - это "слепок" текущего дерева зависимостей, который точно описывает дерево папок в директории ~node_modules~

![warn-25] **_~package-lock.json~_** никогда не будет опубликован, даже если его явно включить в сборку

**_~package-lock.json~_** включает поле **_integrity_** для проверки целостности пакета

^^Указание конкретной версии пакета в **_~package.json~_** фиксирует зависимости только верхнего уровня^^

^^Если ваше приложение будет запущено на другой машине ( пользователя ), то могут быть установлены другие версии пакетов более глубокого уровня, что может "сломать" работу приложения^^

^^Для того, чтобы у конечного пользователя вашего приложения всегда воспроизводилось дерево зависимостей, идентичное вашему на момент публикации, следует использовать **_~shrinkwrap~_** для создания точного слепка этих зависимостей и публикации этого слепка вместе с приложением^^

![](http://icecream.me/uploads/e5b85cfcb24ca4d34562e1e2ae37ae54.png)

____________________________________________________________________________________________________________________

## ![ico-40 npm] npm shrinkwrap

Каждый раз, когда выполняется развертывание ( _deploy_ ) приложения, Node.js запускает **_npm_**

^^Развертывание может существенно затянуться за счет установки новых версий пакетов, указанных в списке зависимостей вашего приложения^^

^^Избежать обновления зависимостей можно путем создания файла **_npm-shrinkwrap.json_**, который фиксирует текущие версии зависимостей вашего приложения^^

^^Формат этого файла полностью идентичен формату **_~package-lock.json~_**^^

![warn-25] **_~npm-shrinkwrap.json~_** может быть частью опубликованного пакета

Если выполнить команду **~npm shrinkwrap~** в папке, в которой уже есть **_~package-lock.json~_**,

**npm** переименует **_~package-lock.json~_** в **_~npm-shrinkwrap.json~_**

Если в папке проекта будут оба файла, **npm** будет использовать **_~npm-shrinkwrap.json~_** и игнорировать **_~package-lock.json~_**

[![ico-20 link] npm shrinkwrap](https://javascript.tutorialhorizon.com/2015/03/21/what-is-npm-shrinkwrap-and-when-is-it-needed/)
